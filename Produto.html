<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Produtos</title>

  <!-- Firebase (v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Fontes e estilo -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#070709;
      --card:#0f1113;
      --muted:#9aa3ad;
      --accent:#00c2ff;
      --accent-2:#8a5cff;
      --glass: rgba(255,255,255,0.03);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #040406 0%, #0b0b0d 60%), radial-gradient(600px 200px at 10% 10%, rgba(0,194,255,0.04), transparent 10%), radial-gradient(600px 200px at 90% 90%, rgba(138,92,255,0.03), transparent 10%);
      color:#e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      min-height:100vh;
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      gap:14px;
      align-items:center;
    }

    .logo{
      width:56px;height:56px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      border-radius:12px;
      box-shadow:0 6px 30px rgba(0,194,255,0.14);
      display:flex; align-items:center; justify-content:center;
      font-family: "Orbitron", monospace;
      font-weight:700;
      color:#041018;
      font-size:18px;
    }

    h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.6px;
    }

    nav a{
      color:var(--muted);
      text-decoration:none;
      margin-left:14px;
      background:transparent;
      padding:8px 12px;
      border-radius:10px;
      transition:all .18s ease;
      border:1px solid transparent;
    }

    nav a:hover{
      color:#fff;
      border-color: rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
    }

    /* painel de filtros + busca */
    .controls{
      margin-top:14px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    .search{
      flex:1;
      display:flex;
      gap:8px;
      align-items:center;
      background:var(--glass);
      padding:8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
    }

    .search input{
      background:transparent;
      border:none;
      outline:none;
      color:var(--muted);
      padding:8px;
      width:100%;
      font-size:14px;
    }

    .select, .btn{
      background:linear-gradient(180deg,#0e1113,#0b0b0b);
      border:1px solid rgba(255,255,255,0.03);
      padding:9px 12px;
      border-radius:10px;
      color:var(--muted);
      cursor:pointer;
      font-weight:500;
      font-size:14px;
    }

    .btn-primary{
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#041018;
      box-shadow:0 10px 30px rgba(0,194,255,0.12);
      border:none;
      font-weight:700;
    }

    /* grid de produtos */
    .grid{
      margin-top:22px;
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.03);
      transition:transform .18s ease, box-shadow .18s ease;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:150px;
    }

    .card:hover{
      transform:translateY(-6px) scale(1.01);
      box-shadow:0 18px 40px rgba(0,0,0,0.6), 0 6px 20px rgba(138,92,255,0.06);
    }

    .thumb {
    width: 100%;
     height: 160px;
     object-fit: cover;   /* faz a imagem se ajustar sem distorcer */
     border-radius: 10px;
     background: #111;    /* cor de fundo se não tiver imagem */
     display: block;      /* garante que a <img> funcione certinho */
        }

    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:auto;
    }

    .name{
      color:#eaf8ff;
      font-weight:700;
      font-size:16px;
    }

    .desc{
      color:var(--muted);
      font-size:13px;
      margin-top:4px;
    }

    .price{
      font-weight:800;
      color:var(--accent);
      background:rgba(0,194,255,0.06);
      padding:6px 10px;
      border-radius:8px;
      font-size:14px;
    }

    .stock{
      font-size:13px;
      color:var(--muted);
    }

    .empty {
      margin-top:28px;
      text-align:center;
      color:var(--muted);
      padding:30px;
      background:rgba(255,255,255,0.02);
      border-radius:12px;
    }

    @media (max-width:700px){
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .controls{flex-direction:column;align-items:stretch}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">PD</div>
        <div>
          <h1>Catálogo Tech — Produtos</h1>
          <div style="font-size:12px;color:var(--muted)">Catálogo público — atualizações em tempo real</div>
        </div>
      </div>

      <nav>
        <!-- volta para a sua primeira página -->
        <a href="catalogo.html">← Voltar ao painel</a>
        <a href="#" id="reloadBtn">⟳ Atualizar</a>
      </nav>
    </header>

    <section class="controls">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" placeholder="Pesquisar por nome ou descrição..." />
      </div>

      <select id="sortSelect" class="select" title="Ordenar">
        <option value="recent">Ordenar: Mais recentes</option>
        <option value="price-asc">Preço ↑</option>
        <option value="price-desc">Preço ↓</option>
      </select>

      <button id="clearBtn" class="select">Limpar filtro</button>
      <button id="openPanel" class="btn btn-primary" onclick="location.href='catalogo.html'">Abrir painel</button>
    </section>

    <main id="mainArea">
      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" style="display:none;">Sem produtos cadastrados.</div>
    </main>
  </div>

  <script>
    // ----- CONFIGURE AQUI: substitua pelos seus dados reais do Firebase -----
    const firebaseConfig = {
      apiKey: "AIzaSyCVQDlF_Ud-yaLMh905aGAuLRLZdTGBSmM",
  authDomain: "catalogo-web-loja-virtual.firebaseapp.com",
  databaseURL: "https://catalogo-web-loja-virtual-default-rtdb.firebaseio.com/",
  projectId: "catalogo-web-loja-virtual",
  storageBucket: "catalogo-web-loja-virtual.firebasestorage.app",
  messagingSenderId: "405243074932",
  appId: "1:405243074932:web:09a55d0acdb9efa1683421",
  measurementId: "G-9MDDN9XTP0"
    
};
    
    // -----------------------------------------------------------------------

    // inicializa
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    } else {
      firebase.app();
    }
    const dbRef = firebase.database().ref('produtos');

    // UI refs
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const clearBtn = document.getElementById('clearBtn');
    const reloadBtn = document.getElementById('reloadBtn');

    let produtosLocal = []; // cache local para filtrar/ordenar

    // função que renderiza a lista (usa o array filtrado)
    function renderList(list){
      grid.innerHTML = '';
      if(!list || list.length === 0){
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      list.forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';

        let thumbHtml;
        if (p.imagem) {
         thumbHtml = `<img src="${escapeHtml(p.imagem)}" class="thumb" alt="${escapeHtml(p.nome)}">`;
        } else {
          thumbHtml = `<div class="thumb">${(p.nome || 'Produto').slice(0,18)}</div>`;
            }


        card.innerHTML = `
          ${thumbHtml}
          <div>
            <div class="name">${escapeHtml(p.nome)}</div>
            <div class="desc">${escapeHtml(p.descricao)}</div>
          </div>

          <div class="meta">
            <div>
              <div class="price">R$ ${Number(p.preco).toFixed(2)}</div>
              <div class="stock">Estoque: ${escapeHtml(p.quantidade)}</div>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // escape simples para evitar injeção no innerHTML
    function escapeHtml(str){
      if(str === undefined || str === null) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // filtra e ordena localmente
    function applyFilters(){
      const q = searchInput.value.trim().toLowerCase();
      let filtered = produtosLocal.slice();

      if(q){
        filtered = filtered.filter(p => {
          const nome = (p.nome || '').toLowerCase();
          const desc = (p.descricao || '').toLowerCase();
          return nome.includes(q) || desc.includes(q);
        });
      }

      const sort = sortSelect.value;
      if(sort === 'price-asc'){
        filtered.sort((a,b)=> Number(a.preco) - Number(b.preco));
      } else if(sort === 'price-desc'){
        filtered.sort((a,b)=> Number(b.preco) - Number(a.preco));
      } else {
        // by key insertion: manter como veio do Firebase (mais recentes por padrão)
      }

      renderList(filtered);
    }

    // recarregar manual
    reloadBtn.addEventListener('click', ()=> {
      // força rebind lendo uma vez
      dbRef.once('value').then(snap => {
        // nada especial: listener em tempo real já está ativo
        console.info('Dados recarregados manualmente.');
      });
    });

    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      sortSelect.value = 'recent';
      applyFilters();
    });

    // input events
    searchInput.addEventListener('input', ()=> applyFilters());
    sortSelect.addEventListener('change', ()=> applyFilters());

    // Listener em tempo real
    dbRef.on('value', snapshot => {
      const arr = [];
      snapshot.forEach(child => {
        const val = child.val();
        // garantir campos mínimos
        arr.push({
          id: child.key,
          nome: val.nome || '',
          descricao: val.descricao || '',
          preco: (val.preco !== undefined) ? parseFloat(val.preco) : 0,
          quantidade: val.quantidade || 0,
          imagem: val.imagem || '',
          createdAt: val.createdAt || null
        });
      });

      // guardar local e aplicar filtros
      produtosLocal = arr;
      applyFilters();
    }, error => {
      console.error('Erro ao ler produtos:', error);
      empty.style.display = 'block';
      empty.textContent = 'Erro ao conectar ao banco. Verifique configuração do Firebase.';
    });

    // pequeno fallback: aviso se firebaseConfig não alterado
    (function checkConfig(){
      if(!firebaseConfig || firebaseConfig.apiKey === "SUA_API_KEY"){
        empty.style.display = 'block';
        empty.innerHTML = 'Produto não carregado — substitua <code>firebaseConfig</code> neste arquivo pelas credenciais do seu projeto Firebase.';
      }
    })();
  </script>

<div>
  <span><a href="#index.html">Voltar ao Inicio</a></span>
</div>
<br>
<br>
</body>
</html>
